<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NEW Viral Video</title>
  <meta property="og:title" content="üî•‡¶´‡ßá‡¶∏‡¶¨‡ßÅ‡¶ï ‡¶ï‡¶æ‡¶Å‡¶™‡¶æ‡¶®‡ßã ‡¶≠‡¶æ‡¶á‡¶∞‡¶æ‡¶≤ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì!" />
  <meta property="og:description" content="Check out the latest collection of viral videos." />
  <meta property="og:image" content="https://archive.org/download/1000002095/1000002095.jpg" />
  <meta property="og:url" content="https://arman-10fe4.web.app/" /> <!-- ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ì‡ßü‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü‡ßá‡¶∞ URL -->
  <meta property="og:type" content="website" />
  <style>
    * { box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      margin: 0; padding: 0;
      background-color: #f4f4f4; color: #333; line-height: 1.6;
    }
    a { color: inherit; text-decoration: none; }
    .header {
      background: linear-gradient(135deg, #ff416c, #ff4b2b);
      color: #fff; text-align: center;
      padding: 2rem 0; margin-bottom: 20px;
    }
    .header h1 { margin: 0; font-size: 2rem; }
    .container { max-width: 1200px; margin: 0 auto; padding: 0 16px 40px; }

    /* Gallery */
    .image-gallery {
      display: grid; gap: 20px;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    }
    .image-item {
      position: relative; overflow: hidden; height: 250px; border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      background: #fff;
      opacity: 0; transform: translateY(20px);
      transition: opacity 0.6s ease-out, transform 0.6s ease-out;
      cursor: pointer;
    }
    .image-item.visible { opacity: 1; transform: translateY(0); }
    .image-item img {
      width: 100%; height: 100%; object-fit: cover; display: block;
    }
    .play-btn {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      display: flex; justify-content: center; align-items: center;
      width: 60px; height: 60px; border-radius: 50%;
      background: rgba(255, 75, 43, 0.85); color: #fff;
      font-size: 1.5rem; font-weight: bold;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      transition: all 0.25s ease;
    }
    .play-btn:hover {
      background: rgba(230, 58, 31, 0.95);
      transform: translate(-50%, -50%) scale(1.15);
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }
    .empty {
      grid-column: 1 / -1;
      text-align: center; padding: 40px; color: #777;
    }

    /* Detail */
    .video-detail { display: none; }
    .back-bar {
      display: flex; align-items: center; gap: 8px;
      margin-bottom: 12px;
    }
    .back-link {
      display: inline-flex; align-items: center; gap: 6px;
      background: #fff; border-radius: 8px; padding: 8px 12px;
      box-shadow: 0 1px 4px rgba(0,0,0,0.08);
    }
    .detail-hero {
      position: relative; border-radius: 12px; overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1); background: #fff;
    }
    .detail-hero img {
      width: 100%; height: auto; display: block;
      max-height: 70vh; object-fit: cover;
    }
    .detail-body {
      background: #fff; margin-top: 16px; padding: 18px;
      border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.06);
    }
    .detail-title { margin: 0 0 10px; font-size: 1.6rem; }
    .detail-desc { margin: 0; color: #444; white-space: pre-wrap; }

    /* Fullscreen Loader Overlay */
    #loaderOverlay {
      position: fixed; inset: 0;
      background: rgba(255,255,255,0.85);
      display: none; /* showLoader() ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶ï‡¶∞‡¶¨‡ßá */
      align-items: center; justify-content: center;
      z-index: 9999;
    }
    .spinner {
      width: 64px; height: 64px;
      border: 6px solid #e9e9e9;
      border-top-color: #ff4b2b; /* brand color */
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Utils */
    .hidden { display: none !important; }
  </style>
</head>
<body>
  <div class="header">
    <h1 id="pageTitle">NEW Viral Video</h1>
  </div>

  <div class="container">
    <!-- Gallery View -->
    <div class="image-gallery" id="videoGallery"></div>

    <!-- Detail View -->
    <div class="video-detail" id="videoDetail">
      <div class="back-bar">
        <a id="backLink" class="back-link" href="#">
          ‚Üê Back to Gallery
        </a>
      </div>

      <div class="detail-hero">
        <img id="detailThumbnail" src="" alt="Video thumbnail">
        <a class="play-btn" id="detailPlayBtn" href="#" target="_blank" title="Play video">‚ñ∂</a>
      </div>

      <div class="detail-body">
        <h2 class="detail-title" id="detailTitle">Loading‚Ä¶</h2>
        <p class="detail-desc" id="detailDescription"></p>
      </div>
    </div>
  </div>

  <!-- Center Spinner Overlay -->
  <div id="loaderOverlay" aria-live="polite">
    <div class="spinner" role="status" aria-label="Loading"></div>
  </div>

  <script type="module">
    // Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import {
      getFirestore, collection, getDocs, doc, getDoc
    } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

    // Firebase config (unchanged)
    const firebaseConfig = {
      apiKey: "AIzaSyDNkDNawZwfjWbpI4db4iOkyuUxuaUt4bs",
      authDomain: "arman-10fe4.firebaseapp.com",
      databaseURL: "https://arman-10fe4-default-rtdb.firebaseio.com",
      projectId: "arman-10fe4",
      storageBucket: "arman-10fe4.appspot.com",
      messagingSenderId: "1086611997302",
      appId: "1:1086611997302:web:caa870bc6d850abbb25557",
      measurementId: "G-32B44CMW7S"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.addEventListener('DOMContentLoaded', () => {
      const pageTitle = document.getElementById('pageTitle');
      const videoGallery = document.getElementById('videoGallery');
      const videoDetail = document.getElementById('videoDetail');

      const detailTitle = document.getElementById('detailTitle');
      const detailDescription = document.getElementById('detailDescription');
      const detailThumbnail = document.getElementById('detailThumbnail');
      const detailPlayBtn = document.getElementById('detailPlayBtn');
      const backLink = document.getElementById('backLink');

      const loaderOverlay = document.getElementById('loaderOverlay');
      const params = new URLSearchParams(window.location.search);
      const videoId = params.get('id');

      backLink.href = window.location.pathname; // Query ‡¶õ‡¶æ‡ßú‡¶æ ‡¶Æ‡ßÇ‡¶≤ ‡¶™‡ßá‡¶ú

      if (videoId) {
        showSection('detail');
        showLoader();
        renderVideoDetail(videoId).finally(hideLoader);
      } else {
        showSection('gallery');
        showLoader();
        fetchAndRenderVideos().finally(hideLoader);
      }

      async function fetchAndRenderVideos() {
        try {
          const snap = await getDocs(collection(db, "videos"));
          videoGallery.innerHTML = '';

          if (snap.empty) {
            videoGallery.innerHTML = '<div class="empty">No videos found in the database.</div>';
            return;
          }

          snap.forEach((d) => {
            const v = d.data();
            const id = d.id;
            const detailLink = `${window.location.pathname}?id=${encodeURIComponent(id)}`;

            const item = document.createElement('div');
            item.className = 'image-item';
            item.innerHTML = `
              <img src="${v.thumbnailUrl || ''}" alt="${escapeHtml(v.title || 'Video')}">
              <a class="play-btn" href="${detailLink}" target="_blank" title="Open details">‚ñ∂</a>
            `;
            // Card-‡¶è ‡¶ï‡ßç‡¶≤‡¶ø‡¶ï ‡¶ï‡¶∞‡¶≤‡ßá ‡¶®‡¶§‡ßÅ‡¶® ‡¶ü‡ßç‡¶Ø‡¶æ‡¶¨‡ßá ‡¶°‡¶ø‡¶ü‡ßá‡¶á‡¶≤ ‡¶™‡ßá‡¶ú
            item.addEventListener('click', (e) => {
              if (e.target.closest('.play-btn')) return; // play-btn ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶Æ‡¶§ ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡ßÅ‡¶ï
              window.open(detailLink, '_blank');
            });

            videoGallery.appendChild(item);
          });

          initializeScrollAnimation();
        } catch (err) {
          console.error('Error fetching videos:', err);
          videoGallery.innerHTML = '<div class="empty" style="color:red">Failed to load videos. Check console for details.</div>';
        }
      }

      async function renderVideoDetail(id) {
        try {
          pageTitle.textContent = 'Loading‚Ä¶';
          document.title = 'Loading‚Ä¶';

          const ref = doc(db, "videos", id);
          const snap = await getDoc(ref);

          if (!snap.exists()) {
            pageTitle.textContent = 'Video not found';
            document.title = 'Video not found';
            detailTitle.textContent = 'Video not found';
            detailDescription.textContent = 'The requested video could not be found.';
            detailThumbnail.src = '';
            detailPlayBtn.style.display = 'none';
            return;
          }

          const v = snap.data();
          const title = v.title || 'Untitled Video';
          const description = v.description || 'No description available.';
          const thumb = v.thumbnailUrl || '';
          const videoUrl = v.videoUrl || '#';

          pageTitle.textContent = title;
          document.title = title + ' | NEW Viral Video';

          detailTitle.textContent = title;
          detailDescription.textContent = description;
          detailThumbnail.alt = title;
          detailThumbnail.src = thumb;

          detailPlayBtn.href = videoUrl;
          detailPlayBtn.style.display = videoUrl && videoUrl !== '#' ? 'flex' : 'none';
        } catch (err) {
          console.error('Error loading video detail:', err);
          pageTitle.textContent = 'Error';
          document.title = 'Error';
          detailTitle.textContent = 'Failed to load video';
          detailDescription.textContent = 'Please try again later.';
          detailPlayBtn.style.display = 'none';
        }
      }

      function showSection(which) {
        if (which === 'detail') {
          videoGallery.classList.add('hidden');
          videoDetail.style.display = 'block';
        } else {
          videoDetail.style.display = 'none';
          videoGallery.classList.remove('hidden');
          pageTitle.textContent = 'NEW Viral Video';
          document.title = 'NEW Viral Video';
        }
      }

      function initializeScrollAnimation() {
        const items = document.querySelectorAll('.image-item');
        if (!items.length) return;
        const obs = new IntersectionObserver((entries, observer) => {
          entries.forEach(e => {
            if (e.isIntersecting) {
              e.target.classList.add('visible');
              observer.unobserve(e.target);
            }
          });
        }, { root: null, rootMargin: '0px', threshold: 0.1 });
        items.forEach(i => obs.observe(i));
      }

      function escapeHtml(str) {
        return String(str).replace(/[&<>"'`=\/]/g, function (s) {
          return ({
            '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;',
            "'": '&#39;', '/': '&#x2F;', '`': '&#x60;', '=': '&#x3D;'
          })[s];
        });
      }

      function showLoader() { loaderOverlay.style.display = 'flex'; }
      function hideLoader() { loaderOverlay.style.display = 'none'; }
    });
  </script>
</body>
  </html>
