<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Viral Video Gallery</title>

  <!-- ডিফল্ট ফেসবুক মেটা ট্যাগ (যদি কেউ সরাসরি সাইট শেয়ার করে) -->
  <meta property="og:title" content="NEW Viral Videos - Watch Now!" />
  <meta property="og:description" content="Check out the latest collection of viral videos." />
  <meta property="og:image" content="https://i3.wp.com/desipornphoto.com/wp-content/uploads/2023/03/20221001_003249.jpg?ssl=1" />
  <meta property="og:url" content="https://arman-10fe4.web.app/" /> <!-- আপনার ওয়েবসাইটের URL -->
  <meta property="og:type" content="website" />

  <style>
    body { font-family: Arial, sans-serif; margin: 0; background-color: #f4f4f4; }
    .header { background: linear-gradient(135deg, #ff416c, #ff4b2b); color: #fff; text-align: center; padding: 2rem 0; margin-bottom: 20px; }
    .header h1 { margin: 0; font-size: 2.5rem; }
    .image-gallery { max-width: 1200px; margin: 0 auto; padding: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; }
    .image-item { position: relative; overflow: hidden; height: 250px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); opacity: 0; transform: translateY(20px); transition: all 0.4s ease; cursor: pointer; }
    .image-item:hover { box-shadow: 0 6px 15px rgba(0,0,0,0.2); transform: translateY(-5px); }
    .image-item.visible { opacity: 1; transform: translateY(0); }
    .image-item img { width: 100%; height: 100%; object-fit: cover; display: block; }
    .loader { text-align: center; padding: 50px; font-size: 1.2rem; grid-column: 1 / -1; }

    /* পপ-আপ স্টাইল */
    .popup { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.85); z-index: 1000; display: none; justify-content: center; align-items: center; padding: 20px; box-sizing: border-box; }
    .popup-content { background-color: #fff; padding: 25px; border-radius: 10px; position: relative; max-width: 600px; width: 100%; text-align: center; animation: fadeIn 0.4s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    .close-btn { position: absolute; top: 10px; right: 15px; font-size: 2rem; color: #888; cursor: pointer; line-height: 1; }
    .popup-image-container { position: relative; margin-bottom: 15px; }
    .popup-image-container img { width: 100%; max-height: 70vh; object-fit: contain; border-radius: 8px; }
    .popup-title { font-size: 1.8rem; margin: 0 0 15px; }
    .popup-play-btn { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); display: flex; justify-content: center; align-items: center; width: 70px; height: 70px; background: rgba(255, 75, 43, 0.85); color: #fff; font-size: 1.8rem; text-decoration: none; border-radius: 50%; box-shadow: 0 4px 15px rgba(0,0,0,0.3); transition: all 0.3s ease; }
    .popup-play-btn:hover { background: rgba(230, 58, 31, 0.95); transform: translate(-50%, -50%) scale(1.2); }
    
    /* শেয়ার বাটন স্টাইল */
    .share-section { margin-top: 20px; border-top: 1px solid #eee; padding-top: 15px; }
    .share-btn { background-color: #1877f2; color: white; border: none; padding: 10px 20px; border-radius: 5px; font-size: 1rem; cursor: pointer; transition: background-color 0.3s; }
    .share-btn:hover { background-color: #166fe5; }
    .copy-feedback { margin-top: 10px; color: green; font-weight: bold; display: none; }
  </style>
</head>
<body>
  
  <div class="header">
    <h1>NEW Viral Video</h1>
  </div>
  
  <div class="image-gallery" id="videoGallery">
    <div class="loader">Loading Videos from Database...</div>
  </div>

  <div class="popup" id="videoPopup">
      <div class="popup-content">
          <span class="close-btn" id="closePopupBtn">&times;</span>
          <h2 class="popup-title" id="popupTitle"></h2>
          <div class="popup-image-container">
              <img id="popupThumbnail" src="" alt="Video Thumbnail">
              <a id="popupPlayBtn" class="popup-play-btn" href="#" target="_blank">▶</a>
          </div>
          <div class="share-section">
            <p>Share this video with your friends!</p>
            <button class="share-btn" id="shareBtn">Copy Share Link</button>
            <p class="copy-feedback" id="copyFeedback">Link Copied!</p>
          </div>
      </div>
  </div>


  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
    import { getFirestore, collection, getDocs, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

    // =========================================================================
    // !! গুরুত্বপূর্ণ !! : ধাপ ২ সম্পন্ন করার পর এই URL টি পরিবর্তন করতে হবে !!
    // =========================================================================
    const cloudFunctionUrl = 'YOUR_CLOUD_FUNCTION_URL_HERE'; 
    // যেমন: 'https://us-central1-arman-10fe4.cloudfunctions.net/share'

    const firebaseConfig = {
      apiKey: "AIzaSyDNkDNawZwfjWbpI4db4iOkyuUxuaUt4bs",
      authDomain: "arman-10fe4.firebaseapp.com",
      databaseURL: "https://arman-10fe4-default-rtdb.firebaseio.com",
      projectId: "arman-10fe4",
      storageBucket: "arman-10fe4.appspot.com",
      messagingSenderId: "1086611997302",
      appId: "1:1086611997302:web:caa870bc6d850abbb25557",
      measurementId: "G-32B44CMW7S"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    document.addEventListener('DOMContentLoaded', async function() {
      const videoGallery = document.getElementById('videoGallery');
      const videoPopup = document.getElementById('videoPopup');
      const closePopupBtn = document.getElementById('closePopupBtn');
      const shareBtn = document.getElementById('shareBtn');
      let currentVideoId = null;

      videoGallery.addEventListener('click', (event) => {
        const clickedItem = event.target.closest('.image-item');
        if (clickedItem) {
          openPopup(clickedItem.dataset.id);
        }
      });
      
      closePopupBtn.addEventListener('click', closePopup);
      videoPopup.addEventListener('click', (event) => {
        if (event.target === videoPopup) {
          closePopup();
        }
      });

      shareBtn.addEventListener('click', () => {
        if (cloudFunctionUrl === 'YOUR_CLOUD_FUNCTION_URL_HERE') {
            alert("Please configure the Cloud Function URL first!");
            return;
        }
        const shareLink = `${cloudFunctionUrl}?id=${currentVideoId}`;
        navigator.clipboard.writeText(shareLink).then(() => {
          const feedback = document.getElementById('copyFeedback');
          feedback.style.display = 'block';
          setTimeout(() => { feedback.style.display = 'none'; }, 2000);
        });
      });

      async function openPopup(videoId) {
        currentVideoId = videoId;
        document.getElementById('popupTitle').textContent = "Loading...";
        document.getElementById('popupThumbnail').src = "";
        videoPopup.style.display = 'flex';

        try {
          const docRef = doc(db, "videos", videoId);
          const docSnap = await getDoc(docRef);
          if (docSnap.exists()) {
            const videoData = docSnap.data();
            document.getElementById('popupTitle').textContent = videoData.title;
            document.getElementById('popupThumbnail').src = videoData.thumbnailUrl;
            document.getElementById('popupPlayBtn').href = videoData.videoUrl;
            document.title = videoData.title;
            // URL পরিবর্তন করে ইউনিক আইডি যোগ করা হচ্ছে
            window.history.pushState({}, videoData.title, `?id=${videoId}`);
          } else {
            document.getElementById('popupTitle').textContent = "Video not found!";
          }
        } catch (error) {
          document.getElementById('popupTitle').textContent = "Failed to load video.";
        }
      }

      function closePopup() {
        videoPopup.style.display = 'none';
        document.title = "Viral Video Gallery";
        window.history.pushState({}, "Viral Video Gallery", window.location.pathname);
        currentVideoId = null;
      }

      async function displayGallery() {
        const querySnapshot = await getDocs(collection(db, "videos"));
        videoGallery.innerHTML = ''; 
        querySnapshot.forEach((doc) => {
          const videoData = doc.data();
          const imageItem = document.createElement('div');
          imageItem.className = 'image-item';
          imageItem.dataset.id = doc.id;
          imageItem.innerHTML = `<img src="${videoData.thumbnailUrl}" alt="${videoData.title}">`;
          videoGallery.appendChild(imageItem);
        });
        initializeScrollAnimation();
      }
      
      function initializeScrollAnimation() {
        const observer = new IntersectionObserver((entries) => {
          entries.forEach(entry => {
            if (entry.isIntersecting) entry.target.classList.add('visible');
          });
        }, { threshold: 0.1 });
        document.querySelectorAll('.image-item').forEach(item => observer.observe(item));
      }

      await displayGallery();
      
      const urlParams = new URLSearchParams(window.location.search);
      const videoIdFromUrl = urlParams.get('id');
      if (videoIdFromUrl) {
        openPopup(videoIdFromUrl);
      }
    });
  </script>
</body>
  </html>
